<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="A vue.js cdn simple diary app, Sign in and start writing your diary">
        <meta name="keywords" content="Vuejs Framework, CSS, JavaScript, HTML5, UIkit, Bootstrap4">
        <meta name="author" content="Madridano, Kolya Nikolai M.">
        <title>Profile</title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.6.5/dist/css/uikit.min.css" />
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"/>
        <link rel="stylesheet" href="css/app.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    </head>
<body>
    <div id="app">
        <div class="container">
            <div class="row justify-content-center mt-5">
                <div class="col-md-7">
                    <h2 class="font-weight-normal  p-0 m-0" v-if="user">{{user?.lastName}}, {{user?.firstName}}</h2>
                    <h6 class="font-weight-normal text-secondary p-0 m-0" v-if="user">{{user.address?.city}}, {{user.address?.country}}</h6>
                    <h6 class="font-weight-normal text-secondary p-0 m-0" v-if="user">{{user?.course}}</h6>
                    <h6 class="font-weight-normal text-secondary p-0 m-0" v-if="user">{{user?.birthDate}}</h6>
                    <iframe 
                        style="margin-top: 150px"
                        id="profileVideo" 
                        width="100%" 
                        height="345" 
                        src="" 
                        frameborder="0" 
                        scrolling="no" 
                        uk-responsive uk-video="automute: true"></iframe>
                </div>
            </div>
        </div>

    </div>
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.6.5/dist/js/uikit.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.6.5/dist/js/uikit-icons.min.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/vue@2"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <script src="https://momentjs.com/downloads/moment-with-locales.min.js"></script>
    <script>
        var app = new Vue({
            el: '#app',
            local: null,
            data: {
                baseUrl: 'https://www.diaryapi.somee.com/',
                user: {},

            },
            methods: {
                componentDidMount: async function(){
                    if(this.local.userId) {
                        await axios.get(this.baseUrl+`api/profile/findBySpecialId/${this.local?.userId}`)
                            .then(res => {
                                this.user = res.data[0];
                                if(this.user.length == 0) return location.href = "editprofile.html";
                                document.title = this.user?.firstName + " " + this.user?.lastName;
                                let youtubeVideoUrl = this.user?.media.video;
                                let youtubeVideoId = youtubeVideoUrl?.slice(youtubeVideoUrl.indexOf("?v=") + 3);
                                document.getElementById('profileVideo').src = `https://www.youtube.com/embed/${youtubeVideoId}?loop=1&autoplay=1&mute=1`;
                            })
                            .catch(err => console.log(err));
                        await axios.get(this.baseUrl+`api/diary/findBySpecialId/${this.local?.userId}`)
                            .then(res =>  this.diaries = res.data.reverse())
                            .catch(err => console.error(err))
                    }
                }
            },
            mounted: function() {
                console.log(Date.parse('2000-06-21T00:00:00'));
                if(localStorage.diaryLocalStorage) {
                    this.local = JSON.parse(localStorage.diaryLocalStorage);
                    this.componentDidMount();
                } else  location.href = "../index.html";
            }
        })
    </script>
</body>
</html>